<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0f6b52">
  <title>Product â€” Flean Market</title>
  <link rel="stylesheet" href="assets/styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600;700&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    .product-detail-page {
      min-height: 100vh;
      padding-bottom: 120px;
    }
    
    .detail-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      background: transparent;
      transition: background 0.3s ease;
    }
    
    .detail-header.scrolled {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .detail-header .back-btn,
    .detail-header .action-btn {
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 50%;
      font-size: 1.25rem;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      border: none;
      cursor: pointer;
    }
    
    .detail-header .action-btns {
      display: flex;
      gap: 0.5rem;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       NUDGE SWAP HERO - The Magic Card Stack
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .nudge-hero-container {
      position: relative;
      height: 420px;
      perspective: 1500px;
      overflow: visible;
      margin-bottom: 1rem;
    }
    
    /* The card stack wrapper */
    .card-stack {
      position: relative;
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
    }
    
    /* Back card - The healthier option */
    .back-card {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 380px;
      background: linear-gradient(145deg, #ecfdf5 0%, #d1fae5 100%);
      border-radius: 0 0 24px 24px;
      overflow: hidden;
      z-index: 1;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }
    
    .back-card-image {
      width: 100%;
      height: 240px;
      object-fit: cover;
    }
    
    .back-card-content {
      padding: 1rem 1.25rem;
    }
    
    .back-card-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.4rem 0.8rem;
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }
    
    .back-card-badge .score-up {
      background: rgba(255,255,255,0.25);
      padding: 0.1rem 0.4rem;
      border-radius: 4px;
      font-size: 0.7rem;
    }
    
    .back-card-brand {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #64748b;
      margin-bottom: 0.2rem;
    }
    
    .back-card-title {
      font-family: var(--font-serif);
      font-size: 1.15rem;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 0.3rem;
    }
    
    .back-card-reason {
      font-size: 0.8rem;
      color: #059669;
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    
    /* Front card - The current product */
    .front-card {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 380px;
      background: white;
      border-radius: 0 0 24px 24px;
      overflow: hidden;
      z-index: 10;
      box-shadow: 0 15px 50px rgba(0,0,0,0.2);
      transform-origin: center bottom;
      cursor: grab;
      touch-action: pan-y;
      will-change: transform;
    }
    
    .front-card:active {
      cursor: grabbing;
    }
    
    .front-card-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .front-card .health-badge {
      position: absolute;
      bottom: 1rem;
      right: 1rem;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: white;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
    }
    
    .front-card .health-badge.low {
      background: linear-gradient(135deg, #ef4444, #dc2626);
    }
    
    .front-card .health-badge.mid {
      background: linear-gradient(135deg, #f59e0b, #d97706);
    }
    
    .front-card .health-badge.good {
      background: linear-gradient(135deg, #10b981, #059669);
    }
    
    .front-card .health-badge strong {
      font-size: 1.3rem;
      line-height: 1;
    }
    
    .front-card .health-badge span {
      font-size: 0.6rem;
      opacity: 0.9;
    }
    
    /* The nudge animation */
    @keyframes nudge-peek {
      0%, 100% {
        transform: translateX(0) rotateY(0) scale(1);
      }
      20% {
        transform: translateX(-100px) rotateY(-12deg) scale(0.96);
      }
      30% {
        transform: translateX(-120px) rotateY(-15deg) scale(0.95);
      }
      50% {
        transform: translateX(-100px) rotateY(-12deg) scale(0.96);
      }
      70% {
        transform: translateX(-50px) rotateY(-6deg) scale(0.98);
      }
    }
    
    .front-card.nudging {
      animation: nudge-peek 2.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }
    
    .front-card.nudging::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, rgba(16,185,129,0.15) 0%, transparent 40%);
      pointer-events: none;
    }
    
    /* Swipe out animation */
    .front-card.swiped-out {
      animation: swipe-away 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    }
    
    @keyframes swipe-away {
      to {
        transform: translateX(-150%) rotateY(-30deg) scale(0.8);
        opacity: 0;
      }
    }
    
    /* Swipe hint indicator */
    .swipe-hint {
      position: absolute;
      bottom: 1rem;
      left: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(8px);
      color: white;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
      z-index: 15;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.4s ease;
    }
    
    .nudge-hero-container.show-hint .swipe-hint {
      opacity: 1;
      transform: translateY(0);
    }
    
    .swipe-hint-arrow {
      animation: swipe-arrow-move 1s ease-in-out infinite;
    }
    
    @keyframes swipe-arrow-move {
      0%, 100% { transform: translateX(0); }
      50% { transform: translateX(-5px); }
    }
    
    /* Better choice banner on back card */
    .better-choice-banner {
      position: absolute;
      top: 1rem;
      left: 1rem;
      right: 1rem;
      padding: 0.75rem 1rem;
      background: linear-gradient(135deg, #059669, #047857);
      color: white;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-weight: 700;
      font-size: 0.85rem;
      box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
      z-index: 2;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       STANDARD HERO (for healthy products)
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .standard-hero {
      position: relative;
      height: 380px;
      background: var(--slate-100);
    }
    
    .standard-hero img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .standard-hero .health-badge {
      position: absolute;
      bottom: -30px;
      right: 1.5rem;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: white;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      z-index: 10;
    }
    
    .standard-hero .health-badge.good {
      background: linear-gradient(135deg, #10b981, #059669);
    }
    
    .standard-hero .health-badge.mid {
      background: linear-gradient(135deg, #f59e0b, #d97706);
    }
    
    .standard-hero .health-badge.low {
      background: linear-gradient(135deg, #ef4444, #dc2626);
    }
    
    .standard-hero .health-badge strong {
      font-size: 1.5rem;
      line-height: 1;
    }
    
    .standard-hero .health-badge span {
      font-size: 0.65rem;
      opacity: 0.9;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PRODUCT INFO SECTION
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .product-info {
      padding: 2rem 1.5rem 1.5rem;
      background: var(--bg-card);
      border-radius: 24px 24px 0 0;
      margin-top: -1.5rem;
      position: relative;
      z-index: 5;
    }
    
    .product-verification {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1rem;
      background: var(--emerald-50);
      border-radius: 12px;
      margin-bottom: 1.5rem;
      font-size: 0.9rem;
    }
    
    .product-verification strong {
      color: var(--emerald-700);
    }
    
    .product-brand {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--slate-500);
      font-weight: 600;
      margin-bottom: 0.25rem;
    }
    
    .product-title {
      font-family: var(--font-serif);
      font-size: 1.75rem;
      font-weight: 700;
      line-height: 1.2;
      margin-bottom: 0.75rem;
    }
    
    .product-rating {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    
    .stars {
      color: #fbbf24;
    }
    
    .rating-text {
      font-size: 0.85rem;
      color: var(--slate-600);
    }
    
    .product-desc {
      font-size: 1rem;
      color: var(--slate-600);
      line-height: 1.6;
      margin-bottom: 1.5rem;
    }
    
    .detail-section {
      margin-bottom: 1.5rem;
    }
    
    .detail-section-title {
      font-size: 0.9rem;
      font-weight: 700;
      color: var(--charcoal);
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .tags-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    
    .tag-chip {
      padding: 0.5rem 1rem;
      background: var(--emerald-100);
      color: var(--emerald-700);
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .tag-chip.warning {
      background: #fee2e2;
      color: #b91c1c;
    }
    
    .nutrition-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0.75rem;
    }
    
    .nutrition-item {
      text-align: center;
      padding: 1rem;
      background: var(--slate-50);
      border-radius: 12px;
    }
    
    .nutrition-value {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--emerald-700);
      display: block;
    }
    
    .nutrition-label {
      font-size: 0.7rem;
      color: var(--slate-500);
      text-transform: uppercase;
    }
    
    /* Sticky Cart Bar */
    .sticky-cart-bar {
      position: fixed;
      bottom: 70px;
      left: 0;
      right: 0;
      padding: 1rem 1.5rem;
      background: var(--bg-elevated);
      border-top: 1px solid var(--slate-200);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      z-index: 90;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
    }
    
    .cart-bar-price {
      display: flex;
      flex-direction: column;
    }
    
    .cart-bar-price .price {
      font-size: 1.5rem;
      font-weight: 800;
    }
    
    .cart-bar-price .unit {
      font-size: 0.8rem;
      color: var(--slate-500);
    }
    
    .cart-bar-btn {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
      padding: 1rem 2rem;
      background: linear-gradient(135deg, var(--emerald-600), var(--emerald-700));
      color: white;
      border: none;
      border-radius: 16px;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 4px 16px rgba(5, 150, 105, 0.3);
      transition: all 0.2s ease;
    }
    
    .cart-bar-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 24px rgba(5, 150, 105, 0.4);
    }
  </style>
</head>
<body data-page="product" class="product-detail-page">
  <!-- Floating Header -->
  <header class="detail-header" id="detailHeader">
    <button class="back-btn" onclick="window.history.back()">â†</button>
    <div class="action-btns">
      <button class="action-btn" onclick="shareProduct()">ğŸ“¤</button>
      <button class="action-btn" onclick="toggleFavorite()" id="favBtn">ğŸ¤</button>
    </div>
  </header>

  <!-- Product Content -->
  <div id="productDetail">
    <div style="padding: 3rem; text-align: center;">
      <div class="loader-dot" style="width: 40px; height: 40px; background: var(--emerald-500); border-radius: 50%; margin: 0 auto; animation: loader-bounce 1s infinite;"></div>
      <p style="margin-top: 1rem; color: var(--slate-500);">Loading product...</p>
    </div>
  </div>

  <!-- Cart Toast -->
  <div class="cart-toast" id="cartToast">
    <div class="toast-content">
      <span class="toast-icon">âœ…</span>
      <div class="toast-text">
        <strong id="toastTitle">Added to cart</strong>
        <span id="toastSubtitle">View cart to checkout</span>
      </div>
    </div>
    <button class="toast-action" onclick="window.location.href='index.html'">Continue</button>
  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <a href="index.html" class="nav-item active">
      <span class="nav-icon">ğŸ </span>
      <span class="nav-label">Home</span>
      <span class="nav-indicator"></span>
    </a>
    <a href="flean_finds.html" class="nav-item">
      <span class="nav-icon">ğŸ’</span>
      <span class="nav-label">Flean Finds</span>
    </a>
    <a href="profile.html" class="nav-item">
      <span class="nav-icon">ğŸ‘¤</span>
      <span class="nav-label">Profile</span>
    </a>
  </nav>

  <script src="assets/script.js"></script>
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PRODUCT DATA - Inline for reliability
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const productData = {
      'maggi-masala': {
        id: 'maggi-masala',
        name: 'Maggi Masala Noodles',
        brand: 'NestlÃ©',
        description: 'Classic instant noodles with refined flour and MSG â€” convenient but not ideal for regular consumption.',
        category: 'pantry',
        price: 12,
        unit: 'pack',
        image: 'https://images.unsplash.com/photo-1612929633738-8fe44f7ec841?w=400',
        tags: ['Quick Meal'],
        watchouts: ['Refined Flour', 'Palm Oil', 'Added Sugar', 'High Sodium', 'MSG'],
        healthScore: 32,
        swap: {
          id: 'slurrp-millet',
          name: 'Millet & Veggie Noodles',
          brand: 'Slurrp Farm',
          image: 'https://images.unsplash.com/photo-1569718212165-3a8278d5f624?w=400',
          healthScore: 88,
          price: 45,
          reason: 'Whole millet grains vs refined flour'
        }
      },
      'slurrp-millet': {
        id: 'slurrp-millet',
        name: 'Millet & Veggie Noodles',
        brand: 'Slurrp Farm',
        description: 'Little millet noodles with hidden veggies, no preservatives or artificial colors.',
        category: 'pantry',
        price: 45,
        unit: 'pack',
        image: 'https://images.unsplash.com/photo-1569718212165-3a8278d5f624?w=400',
        tags: ['No Preservatives', 'Whole Grain', 'High Fiber', 'No Added Sugar', 'No MSG'],
        watchouts: [],
        healthScore: 88,
        swap: null
      },
      'lays-classic': {
        id: 'lays-classic',
        name: 'Classic Salted Chips',
        brand: "Lay's",
        description: 'Crispy potato chips fried in palm oil with high sodium content.',
        category: 'snacks',
        price: 20,
        unit: 'pack',
        image: 'https://images.unsplash.com/photo-1566478989037-eec170784d0b?w=400',
        tags: ['Popular Choice'],
        watchouts: ['Palm Oil', 'High Sodium', 'Refined Oil'],
        healthScore: 28,
        swap: {
          id: 'farmley-nuts',
          name: 'Roasted Mixed Nuts',
          brand: 'Farmley',
          image: 'https://images.unsplash.com/photo-1599599810769-bcde5a160d32?w=400',
          healthScore: 91,
          price: 199,
          reason: 'Heart-healthy fats vs refined oils'
        }
      },
      'farmley-nuts': {
        id: 'farmley-nuts',
        name: 'Roasted Mixed Nuts',
        brand: 'Farmley',
        description: 'Dry roasted almonds, cashews, and walnuts with no added oil or salt.',
        category: 'snacks',
        price: 199,
        unit: '200g',
        image: 'https://images.unsplash.com/photo-1599599810769-bcde5a160d32?w=400',
        tags: ['No Added Salt', 'No Oil', 'High Protein', 'Heart Healthy'],
        watchouts: [],
        healthScore: 91,
        swap: null
      },
      'good-day-butter': {
        id: 'good-day-butter',
        name: 'Good Day Butter Cookies',
        brand: 'Britannia',
        description: 'Popular tea-time biscuits rich in refined flour and refined sugar.',
        category: 'sweets',
        price: 35,
        unit: 'pack',
        image: 'https://images.unsplash.com/photo-1558961363-fa8fdf82db35?w=400',
        tags: ['Tea Time Classic'],
        watchouts: ['Refined Flour', 'Added Sugar', 'Artificial Colors', 'Palm Oil'],
        healthScore: 38,
        swap: {
          id: 'yogabar-cookies',
          name: 'Oats & Dark Chocolate Cookies',
          brand: 'Yoga Bar',
          image: 'https://images.unsplash.com/photo-1499636136210-6f4ee915583e?w=400',
          healthScore: 82,
          price: 89,
          reason: 'Rolled oats instead of refined flour'
        }
      },
      'yogabar-cookies': {
        id: 'yogabar-cookies',
        name: 'Oats & Dark Chocolate Cookies',
        brand: 'Yoga Bar',
        description: 'Slow-baked cookies with rolled oats, dark chocolate, and jaggery.',
        category: 'sweets',
        price: 89,
        unit: 'pack',
        image: 'https://images.unsplash.com/photo-1499636136210-6f4ee915583e?w=400',
        tags: ['Whole Grain', 'No Preservatives', 'No Refined Sugar', 'High Fiber'],
        watchouts: [],
        healthScore: 82,
        swap: null
      },
      'hersheys-syrup': {
        id: 'hersheys-syrup',
        name: 'Chocolate Syrup',
        brand: "Hershey's",
        description: 'Sweet chocolate syrup made with high fructose corn syrup.',
        category: 'sweets',
        price: 199,
        unit: 'bottle',
        image: 'https://images.unsplash.com/photo-1606312619070-d48b4c652a52?w=400',
        tags: ['Dessert Topping'],
        watchouts: ['High Fructose Corn Syrup', 'Added Sugar', 'Artificial Flavors'],
        healthScore: 22,
        swap: {
          id: 'natures-cocoa',
          name: 'Organic Cacao Powder',
          brand: 'Nature',
          image: 'https://images.unsplash.com/photo-1610611826689-1a5f5db2a9f4?w=400',
          healthScore: 95,
          price: 350,
          reason: 'Raw cacao with antioxidants'
        }
      },
      'natures-cocoa': {
        id: 'natures-cocoa',
        name: 'Organic Cacao Powder',
        brand: 'Nature',
        description: 'Raw organic cacao powder, unsweetened, full of antioxidants.',
        category: 'organic',
        price: 350,
        unit: '200g',
        image: 'https://images.unsplash.com/photo-1610611826689-1a5f5db2a9f4?w=400',
        tags: ['Organic', 'No Sugar', 'Raw', 'Antioxidants', 'Superfood'],
        watchouts: [],
        healthScore: 95,
        swap: null
      },
      'tropicana-delight': {
        id: 'tropicana-delight',
        name: 'Mixed Fruit Juice',
        brand: 'Tropicana',
        description: 'Packaged fruit juice from concentrate with added sugar.',
        category: 'beverages',
        price: 45,
        unit: '1L',
        image: 'https://images.unsplash.com/photo-1600271886742-f049cd451bba?w=400',
        tags: ['Vitamin C Added'],
        watchouts: ['Added Sugar', 'From Concentrate', 'Preservatives'],
        healthScore: 42,
        swap: {
          id: 'raw-pressery-orange',
          name: 'Cold Pressed Orange Juice',
          brand: 'Raw Pressery',
          image: 'https://images.unsplash.com/photo-1621506289937-a8e4df240d0b?w=400',
          healthScore: 94,
          price: 120,
          reason: 'Cold pressed, not from concentrate'
        }
      },
      'raw-pressery-orange': {
        id: 'raw-pressery-orange',
        name: 'Cold Pressed Orange Juice',
        brand: 'Raw Pressery',
        description: 'Freshly cold-pressed Valencia oranges with no added sugar or preservatives.',
        category: 'beverages',
        price: 120,
        unit: '1L',
        image: 'https://images.unsplash.com/photo-1621506289937-a8e4df240d0b?w=400',
        tags: ['Cold Pressed', 'No Added Sugar', 'No Preservatives', '100% Natural'],
        watchouts: [],
        healthScore: 94,
        swap: null
      }
    };
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDER PRODUCT DETAIL
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function renderProduct() {
      const container = document.getElementById('productDetail');
      const productId = new URLSearchParams(window.location.search).get('id');
      
      // Try local data first, then global
      let product = productData[productId];
      if (!product && window.products) {
        const globalProduct = window.products.find(p => p.id === productId);
        if (globalProduct) {
          product = {
            ...globalProduct,
            swap: window.productSwaps?.[productId] ? {
              id: window.productSwaps[productId].swapId,
              ...window.products.find(p => p.id === window.productSwaps[productId].swapId),
              reason: window.productSwaps[productId].reasons?.[0]
            } : null
          };
        }
      }
      
      if (!product) {
        container.innerHTML = `
          <div style="text-align: center; padding: 4rem 2rem;">
            <div style="font-size: 5rem; margin-bottom: 1rem;">ğŸ¤·</div>
            <h2 style="font-family: var(--font-serif); margin-bottom: 0.5rem;">Product Not Found</h2>
            <p style="color: var(--slate-500); margin-bottom: 1.5rem;">This product may have been removed.</p>
            <a href="index.html" style="display: inline-flex; padding: 0.75rem 1.5rem; background: var(--emerald-600); color: white; border-radius: 999px; font-weight: 600; text-decoration: none;">
              â† Back to Home
            </a>
          </div>
        `;
        return;
      }
      
      const badgeClass = product.healthScore >= 75 ? 'good' : product.healthScore >= 50 ? 'mid' : 'low';
      const NUDGE_THRESHOLD = 50;
      const showNudge = product.swap && product.healthScore < NUDGE_THRESHOLD;
      
      container.innerHTML = `
        ${showNudge ? `
          <!-- NUDGE HERO - Card Stack with Animation -->
          <div class="nudge-hero-container" id="nudgeHero">
            <div class="card-stack">
              <!-- Back Card - The Better Choice -->
              <div class="back-card" id="backCard">
                <div class="better-choice-banner">
                  <span>âœ¨</span>
                  <span>Swipe to see a healthier choice</span>
                </div>
                <img class="back-card-image" src="${product.swap.image}" alt="${product.swap.name}" onerror="this.src='https://via.placeholder.com/400x240?text=Better+Choice'">
                <div class="back-card-content">
                  <div class="back-card-badge">
                    <span>â­ ${product.swap.healthScore}/100</span>
                    <span class="score-up">+${product.swap.healthScore - product.healthScore} pts</span>
                  </div>
                  <p class="back-card-brand">${product.swap.brand}</p>
                  <h3 class="back-card-title">${product.swap.name}</h3>
                  <p class="back-card-reason">
                    <span>âœ“</span>
                    ${product.swap.reason}
                  </p>
                </div>
              </div>
              
              <!-- Front Card - Current Product -->
              <div class="front-card" id="frontCard" data-swap-id="${product.swap.id}">
                <img class="front-card-image" src="${product.image}" alt="${product.name}" onerror="this.src='https://via.placeholder.com/400x380?text=Product'">
                <div class="health-badge ${badgeClass}">
                  <strong>${product.healthScore}</strong>
                  <span>/100</span>
                </div>
                <div class="swipe-hint">
                  <span class="swipe-hint-arrow">ğŸ‘ˆ</span>
                  <span>Swipe for better</span>
                </div>
              </div>
            </div>
          </div>
        ` : `
          <!-- Standard Hero -->
          <div class="standard-hero">
            <img src="${product.image}" alt="${product.name}" onerror="this.src='https://via.placeholder.com/400x380?text=Product'">
            <div class="health-badge ${badgeClass}">
              <strong>${product.healthScore}</strong>
              <span>/100</span>
            </div>
          </div>
        `}
        
        <!-- Product Info -->
        <div class="product-info">
          <div class="product-verification">
            <span>âœ“</span>
            <span><strong>Flean-verified</strong> Â· Scored & analyzed for you</span>
          </div>
          
          <p class="product-brand">${product.brand}</p>
          <h1 class="product-title">${product.name}</h1>
          
          <div class="product-rating">
            <span class="stars">â˜…â˜…â˜…â˜…â˜†</span>
            <span class="rating-text">4.2 (128 reviews)</span>
          </div>
          
          <p class="product-desc">${product.description}</p>
          
          <!-- Tags -->
          <div class="detail-section">
            <div class="tags-list">
              ${product.tags.map(tag => `<span class="tag-chip">âœ“ ${tag}</span>`).join('')}
              ${product.watchouts.map(w => `<span class="tag-chip warning">âš ï¸ ${w}</span>`).join('')}
            </div>
          </div>
          
          <!-- Health Score -->
          <div class="detail-section">
            <h3 class="detail-section-title">ğŸ¥ Health Score</h3>
            <div style="background: ${badgeClass === 'good' ? 'var(--emerald-50)' : badgeClass === 'mid' ? '#fef3c7' : '#fee2e2'}; border-radius: 12px; padding: 1rem;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                <span style="font-weight: 600;">Overall Score</span>
                <span style="font-size: 1.25rem; font-weight: 800; color: ${badgeClass === 'good' ? 'var(--emerald-700)' : badgeClass === 'mid' ? '#d97706' : '#dc2626'};">${product.healthScore}/100</span>
              </div>
              <div style="background: rgba(0,0,0,0.1); border-radius: 999px; height: 8px; overflow: hidden;">
                <div style="width: ${product.healthScore}%; height: 100%; background: ${badgeClass === 'good' ? 'var(--emerald-500)' : badgeClass === 'mid' ? '#f59e0b' : '#ef4444'}; border-radius: 999px;"></div>
              </div>
              <p style="font-size: 0.85rem; color: var(--slate-600); margin-top: 0.75rem;">
                ${badgeClass === 'good' ? 'âœ… Green light! Your body will thank you later.' : 
                  badgeClass === 'mid' ? 'âš ï¸ It\'s complicated. Good enough for a cheat day.' :
                  'âŒ Our AI is giving you the side-eye. Try the swap above!'}
              </p>
            </div>
          </div>
        </div>
        
        <!-- Sticky Cart Bar -->
        <div class="sticky-cart-bar">
          <div class="cart-bar-price">
            <span class="price">â‚¹${product.price}</span>
            <span class="unit">${product.unit}</span>
          </div>
          <button class="cart-bar-btn" onclick="addToCart('${product.id}')">
            ğŸ›’ Add to Cart
          </button>
        </div>
      `;
      
      document.title = `${product.name} â€” Flean`;
      
      // Initialize nudge if applicable
      if (showNudge) {
        setTimeout(initNudgeAnimation, 800);
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // NUDGE ANIMATION & SWIPE LOGIC
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    let swipeState = {
      startX: 0,
      currentX: 0,
      isDragging: false
    };
    
    function initNudgeAnimation() {
      const container = document.getElementById('nudgeHero');
      const frontCard = document.getElementById('frontCard');
      const backCard = document.getElementById('backCard');
      
      if (!frontCard || !container) {
        console.warn('Nudge elements not found');
        return;
      }
      
      console.log('ğŸ¯ Initializing nudge animation...');
      
      // Trigger the peek animation
      setTimeout(() => {
        frontCard.classList.add('nudging');
        console.log('ğŸ¬ Nudge animation started!');
        
        // Show hint after animation
        setTimeout(() => {
          container.classList.add('show-hint');
        }, 2000);
        
        // Remove nudging class after animation
        setTimeout(() => {
          frontCard.classList.remove('nudging');
        }, 2500);
      }, 500);
      
      // Setup swipe handling
      setupSwipeHandlers(frontCard, container);
    }
    
    function setupSwipeHandlers(card, container) {
      // Touch events
      card.addEventListener('touchstart', (e) => {
        swipeState.isDragging = true;
        swipeState.startX = e.touches[0].clientX;
        card.style.transition = 'none';
      }, { passive: true });
      
      card.addEventListener('touchmove', (e) => {
        if (!swipeState.isDragging) return;
        
        const deltaX = e.touches[0].clientX - swipeState.startX;
        
        // Only allow left swipe
        if (deltaX > 0) return;
        
        swipeState.currentX = deltaX;
        const rotation = (deltaX / 300) * 15;
        const scale = Math.max(0.9, 1 + (deltaX / 1000));
        
        card.style.transform = `translateX(${deltaX}px) rotateY(${rotation}deg) scale(${scale})`;
      }, { passive: true });
      
      card.addEventListener('touchend', () => {
        if (!swipeState.isDragging) return;
        swipeState.isDragging = false;
        
        if (swipeState.currentX < -80) {
          completeSwipe(card);
        } else {
          resetCard(card);
        }
        swipeState.currentX = 0;
      });
      
      // Mouse events for desktop
      card.addEventListener('mousedown', (e) => {
        swipeState.isDragging = true;
        swipeState.startX = e.clientX;
        card.style.transition = 'none';
        card.style.cursor = 'grabbing';
      });
      
      document.addEventListener('mousemove', (e) => {
        if (!swipeState.isDragging) return;
        
        const deltaX = e.clientX - swipeState.startX;
        
        if (deltaX > 0) return;
        
        swipeState.currentX = deltaX;
        const rotation = (deltaX / 300) * 15;
        const scale = Math.max(0.9, 1 + (deltaX / 1000));
        
        card.style.transform = `translateX(${deltaX}px) rotateY(${rotation}deg) scale(${scale})`;
      });
      
      document.addEventListener('mouseup', () => {
        if (!swipeState.isDragging) return;
        swipeState.isDragging = false;
        card.style.cursor = 'grab';
        
        if (swipeState.currentX < -80) {
          completeSwipe(card);
        } else {
          resetCard(card);
        }
        swipeState.currentX = 0;
      });
    }
    
    function resetCard(card) {
      card.style.transition = 'transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)';
      card.style.transform = 'translateX(0) rotateY(0) scale(1)';
    }
    
    function completeSwipe(card) {
      card.classList.add('swiped-out');
      
      // Haptic feedback
      if (navigator.vibrate) navigator.vibrate([20, 50, 20]);
      
      // Show toast
      showToast('ğŸ‰ Great choice!', 'Loading healthier alternative...');
      
      // Navigate to swap product
      const swapId = card.dataset.swapId;
      setTimeout(() => {
        window.location.href = `product.html?id=${swapId}`;
      }, 600);
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UTILITY FUNCTIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function shareProduct() {
      if (navigator.share) {
        navigator.share({
          title: 'Check out this product on Flean!',
          url: window.location.href
        });
      } else {
        navigator.clipboard?.writeText(window.location.href);
        showToast('Link copied!', 'Share this product with friends');
      }
    }
    
    let isFavorite = false;
    function toggleFavorite() {
      isFavorite = !isFavorite;
      const btn = document.getElementById('favBtn');
      btn.textContent = isFavorite ? 'â¤ï¸' : 'ğŸ¤';
      
      if (isFavorite) {
        showToast('Added to favorites', 'Find it in your profile');
      }
    }
    
    // Header scroll effect
    window.addEventListener('scroll', () => {
      const header = document.getElementById('detailHeader');
      if (header) {
        header.classList.toggle('scrolled', window.scrollY > 50);
      }
    });
    
    // Initialize on load
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(renderProduct, 300);
    });
  </script>
</body>
</html>
