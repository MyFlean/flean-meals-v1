<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0f6b52">
  <title>Product â€” Flean Market</title>
  <link rel="stylesheet" href="assets/styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600;700&family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    /* Base Setup */
    body {
      background-color: #f8f9fa;
      font-family: 'Montserrat', sans-serif;
      overflow-x: hidden;
    }

    .product-detail-page {
      padding-bottom: 120px;
    }

    .detail-header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      pointer-events: none;
      transition: background 0.3s ease;
    }
    
    .detail-header.scrolled {
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(10px);
      pointer-events: auto;
    }

    .detail-header button {
      pointer-events: auto;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 50%;
      font-size: 1.25rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border: none;
      cursor: pointer;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CARD STACK HERO
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .hero-section {
      position: relative;
      height: 580px; /* Fixed height for the interaction area */
      display: flex;
      align-items: center;
      justify-content: center;
      perspective: 1200px;
      overflow: hidden;
      margin-bottom: -2rem; /* Overlap with details */
      background: linear-gradient(180deg, #e2e8f0 0%, #f8f9fa 100%);
    }

    .card-stack-wrapper {
      position: relative;
      width: 90%;
      max-width: 360px;
      height: 480px;
      transform-style: preserve-3d;
    }

    /* Shared Card Styles */
    .product-card-ui {
      position: absolute;
      inset: 0;
      border-radius: 32px;
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      backface-visibility: hidden;
      box-shadow: 0 20px 50px rgba(0,0,0,0.15), 0 1px 3px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .card-image-area {
      position: relative;
      height: 50%;
      margin: -1.5rem -1.5rem 1.5rem;
      overflow: hidden;
      border-radius: 32px 32px 0 0;
    }

    .card-image-area img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .card-content {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .card-title-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.5rem;
    }

    .card-title {
      font-family: 'Playfair Display', serif;
      font-size: 1.75rem;
      font-weight: 700;
      line-height: 1.1;
      color: #1a1a1a;
      flex: 1;
      padding-right: 1rem;
    }

    .card-price {
      font-size: 1.5rem;
      font-weight: 800;
      color: #1a1a1a;
      white-space: nowrap;
    }

    .score-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.4rem 0.8rem;
      border-radius: 99px;
      font-size: 0.85rem;
      font-weight: 700;
      width: fit-content;
      margin-bottom: 1.5rem;
    }

    .info-list {
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      margin-bottom: auto;
    }

    .info-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .action-button {
      width: 100%;
      padding: 1rem;
      border-radius: 16px;
      font-size: 1rem;
      font-weight: 700;
      color: white;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      transition: transform 0.2s ease;
    }
    
    /* ğŸ”´ UNHEALTHY CARD (Front) */
    .card-front {
      background: white;
      z-index: 10;
      transform-origin: center 120%; /* Pivot from way below for better arc */
      transition: transform 0.1s ease-out;
      cursor: grab;
    }
    
    .card-front:active {
      cursor: grabbing;
    }

    /* Pronounced Tilt Animation */
    .card-front.auto-nudge {
      animation: nudge-deep 2.5s cubic-bezier(0.25, 1, 0.5, 1) forwards;
    }

    @keyframes nudge-deep {
      0% { transform: translateX(0) rotate(0); }
      20% { transform: translateX(-60px) rotate(-12deg); }
      35% { transform: translateX(-65px) rotate(-14deg); }
      100% { transform: translateX(0) rotate(0); }
    }

    .card-front .score-badge {
      background: #fee2e2;
      color: #b91c1c;
    }

    .card-front .action-button {
      background: #9a3412;
      box-shadow: 0 8px 20px rgba(154, 52, 18, 0.3);
    }

    /* ğŸŸ¢ HEALTHY CARD (Back) */
    .card-back {
      background: linear-gradient(145deg, #10b981 0%, #065f46 100%);
      color: white;
      z-index: 5;
      transform: scale(0.92) translateY(20px);
      opacity: 1;
      transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .card-back .card-title, 
    .card-back .card-price {
      color: white;
    }

    .card-back .score-badge {
      background: rgba(255,255,255,0.25);
      color: white;
      backdrop-filter: blur(4px);
    }

    .card-back .action-button {
      background: white;
      color: #059669;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }
    
    /* Better Option Tab */
    .better-option-tab {
      position: absolute;
      right: 10%;
      top: 45%;
      transform: translateY(-50%) translateX(40px);
      background: #10b981;
      color: white;
      padding: 0.75rem 1.25rem;
      border-radius: 16px;
      font-size: 0.9rem;
      font-weight: 700;
      box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);
      opacity: 0;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      z-index: 8;
      pointer-events: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .card-front.auto-nudge ~ .better-option-tab {
      opacity: 1;
      transform: translateY(-50%) translateX(15px);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PRODUCT DETAILS SECTION (The rest of the PDP)
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .product-details-container {
      position: relative;
      z-index: 20;
      background: white;
      border-radius: 32px 32px 0 0;
      padding: 2.5rem 1.5rem 100px;
      box-shadow: 0 -10px 40px rgba(0,0,0,0.05);
      min-height: 50vh;
    }

    .detail-row {
      margin-bottom: 2rem;
    }

    .detail-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: #64748b;
      font-weight: 700;
      margin-bottom: 0.75rem;
    }

    .detail-text {
      font-size: 1rem;
      line-height: 1.7;
      color: #334155;
    }

    .tags-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
    }

    .tag-pill {
      padding: 0.5rem 1rem;
      background: #f1f5f9;
      color: #475569;
      border-radius: 99px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    /* Standard Hero (Non-Stack) */
    .standard-hero {
      height: 400px;
      width: 100%;
      position: relative;
    }
    
    .standard-hero img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    /* Canvas Confetti */
    #confetti-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 9999;
    }

  </style>
</head>
<body data-page="product">
  
  <header class="detail-header" id="mainHeader">
    <button onclick="window.history.back()">â†</button>
    <div style="display:flex; gap:0.5rem">
      <button onclick="share()">ğŸ“¤</button>
      <button>ğŸ¤</button>
    </div>
  </header>

  <canvas id="confetti-canvas"></canvas>

  <!-- React-like Root -->
  <div id="root"></div>

  <script src="assets/script.js"></script>
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PRODUCT DATA
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const productData = {
      'maggi-masala': {
        id: 'maggi-masala',
        name: 'Maggi Masala Noodles',
        brand: 'NestlÃ©',
        price: 12,
        unit: 'pack',
        image: 'https://images.unsplash.com/photo-1612929633738-8fe44f7ec841?w=400',
        score: 32,
        calories: '320 cal',
        description: 'Classic instant noodles with refined flour and MSG. A quick meal, but high in sodium and processed carbohydrates.',
        ingredients: 'Refined Wheat Flour, Palm Oil, Salt, Wheat Gluten, Thickeners (508, 412), Acidity Regulators (501, 500).',
        watchouts: ['High Sodium (890mg)', 'Refined Flour', 'Palm Oil'],
        tags: ['Instant', 'Spicy', 'Budget'],
        swap: {
          id: 'slurrp-millet',
          name: 'Millet & Veggie Noodles',
          brand: 'Slurrp Farm',
          price: 45,
          image: 'https://images.unsplash.com/photo-1569718212165-3a8278d5f624?w=400',
          score: 88,
          calories: '280 cal',
          benefits: ['Whole Grain Millet', 'No MSG / Preservatives', '3x More Fiber']
        }
      },
      'slurrp-millet': {
        id: 'slurrp-millet',
        name: 'Millet & Veggie Noodles',
        brand: 'Slurrp Farm',
        price: 45,
        unit: 'pack',
        image: 'https://images.unsplash.com/photo-1569718212165-3a8278d5f624?w=400',
        score: 88,
        calories: '280 cal',
        description: 'Healthy millet noodles with hidden veggies. No refined flour, no palm oil, just wholesome goodness.',
        ingredients: 'Little Millet Flour, Whole Wheat Flour, Dehydrated Vegetables (Spinach, Carrot), Spice Mix.',
        tags: ['Healthy', 'Millet', 'Kids Friendly'],
        watchouts: [],
        swap: null
      },
      // Default fallback
      'default': {
        id: 'default',
        name: 'Product',
        price: 0,
        image: 'https://via.placeholder.com/400',
        score: 80,
        description: 'Product details...',
        swap: null
      }
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // RENDERING LOGIC
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function render() {
      const root = document.getElementById('root');
      const params = new URLSearchParams(window.location.search);
      const pid = params.get('id');
      const celebrate = params.get('celebrate');
      
      // Get data locally or fallback to global
      let product = productData[pid];
      if (!product && window.products) {
        product = window.products.find(p => p.id === pid);
        if (product) {
          // formatting global data to local structure
          product.watchouts = product.watchouts || [];
          product.calories = 'N/A';
        }
      }
      if (!product) product = productData['default'];

      // Celebration Check
      if (celebrate === 'true') {
        fireConfetti();
        showToast('ğŸ‰ Great Choice!', 'You swapped for a healthier option!');
      }

      // Determine View Mode
      const hasSwap = productData[pid] && productData[pid].swap;
      
      let html = '';
      
      if (hasSwap) {
        // 1. CARD STACK HERO
        html += renderCardStackHero(product);
      } else {
        // 1. STANDARD HERO
        html += renderStandardHero(product);
      }

      // 2. DETAILS (Always visible)
      html += renderProductDetails(product);

      root.innerHTML = html;

      // Initialize Interaction if stack exists
      if (hasSwap) {
        setTimeout(initStackInteraction, 500);
      }
      
      // Header scroll effect
      window.addEventListener('scroll', () => {
        const header = document.getElementById('mainHeader');
        if (window.scrollY > 50) header.classList.add('scrolled');
        else header.classList.remove('scrolled');
      });
    }

    function renderCardStackHero(product) {
      return `
        <div class="hero-section">
          <div class="card-stack-wrapper">
            
            <!-- HEALTHY CARD (Back) -->
            <div class="product-card-ui card-back" id="cardBack">
              <div class="card-image-area">
                <img src="${product.swap.image}" alt="${product.swap.name}">
              </div>
              <div class="card-content">
                <div class="card-title-row">
                  <h1 class="card-title">${product.swap.name}</h1>
                  <span class="card-price">â‚¹${product.swap.price}</span>
                </div>
                <div class="score-badge">
                  <span>âš¡ ${product.swap.calories}</span>
                  <span style="margin-left:8px">â­ ${product.swap.score}/100</span>
                </div>
                <div class="info-list">
                  ${product.swap.benefits.map(b => `
                    <div class="info-item">
                      <span style="color:#fbbf24">âœ”</span> ${b}
                    </div>
                  `).join('')}
                </div>
                <button class="action-button">
                  Wait for it...
                </button>
              </div>
            </div>

            <!-- UNHEALTHY CARD (Front) -->
            <div class="product-card-ui card-front" id="cardFront" data-swap-id="${product.swap.id}">
              <div class="card-image-area">
                <img src="${product.image}" alt="${product.name}">
              </div>
              <div class="card-content">
                <div class="card-title-row">
                  <h1 class="card-title">${product.name}</h1>
                  <span class="card-price">â‚¹${product.price}</span>
                </div>
                <div class="score-badge">
                  <span>ğŸ”¥ ${product.calories}</span>
                  <span style="margin-left:8px">âš ï¸ ${product.score}/100</span>
                </div>
                <div class="info-list">
                  ${product.watchouts.map(w => `
                    <div class="info-item" style="color:#ef4444">
                      <span>âš </span> ${w}
                    </div>
                  `).join('')}
                </div>
                <button class="action-button" onclick="addToCart('${product.id}')">
                  ğŸ›’ Add to Cart
                </button>
              </div>
            </div>
            
            <!-- TAB TIP -->
            <div class="better-option-tab" id="betterTab">
              <span>Better option available</span>
              <span>ğŸ‘‰</span>
            </div>

          </div>
        </div>
      `;
    }

    function renderStandardHero(product) {
      const badgeColor = product.score > 70 ? '#10b981' : '#ef4444';
      return `
        <div class="standard-hero">
          <img src="${product.image}" alt="${product.name}">
          <div style="position:absolute; bottom:-30px; right:20px; width:80px; height:80px; background:${badgeColor}; border-radius:50%; display:flex; flex-direction:column; align-items:center; justify-content:center; color:white; box-shadow:0 8px 20px rgba(0,0,0,0.2);">
            <span style="font-weight:800; font-size:1.5rem; line-height:1">${product.score}</span>
            <span style="font-size:0.7rem; opacity:0.9">/100</span>
          </div>
        </div>
        <div style="height:20px"></div>
      `;
    }

    function renderProductDetails(product) {
      return `
        <div class="product-details-container">
          <div style="margin-bottom:2rem">
            <p style="font-size:0.8rem; text-transform:uppercase; color:#64748b; margin-bottom:0.5rem; font-weight:700">${product.brand || 'Brand'}</p>
            <h1 style="font-family:'Playfair Display'; font-size:2rem; line-height:1.2; color:#1a1a1a">${product.name}</h1>
            <p style="font-size:1.5rem; font-weight:800; color:#1a1a1a; margin-top:0.5rem">â‚¹${product.price}</p>
          </div>

          <div class="detail-row">
            <div class="detail-label">Description</div>
            <p class="detail-text">${product.description || 'No description available.'}</p>
          </div>

          ${product.ingredients ? `
          <div class="detail-row">
            <div class="detail-label">Ingredients</div>
            <p class="detail-text" style="font-size:0.9rem">${product.ingredients}</p>
          </div>
          ` : ''}

          ${product.tags ? `
          <div class="detail-row">
            <div class="detail-label">Tags</div>
            <div class="tags-grid">
              ${product.tags.map(t => `<span class="tag-pill">${t}</span>`).join('')}
            </div>
          </div>
          ` : ''}
          
          <div style="height:50px"></div>
        </div>
      `;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INTERACTION & ANIMATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function initStackInteraction() {
      const front = document.getElementById('cardFront');
      const tab = document.getElementById('betterTab');
      if (!front) return;

      // 1. Trigger Auto Nudge
      setTimeout(() => {
        front.classList.add('auto-nudge');
      }, 800);

      // 2. Drag Logic
      let startX = 0;
      let currentX = 0;
      let isDragging = false;

      function handleStart(x) {
        front.classList.remove('auto-nudge');
        tab.style.opacity = '0';
        isDragging = true;
        startX = x;
        front.style.transition = 'none';
      }

      function handleMove(x) {
        if (!isDragging) return;
        const deltaX = x - startX;
        if (deltaX > 20) return; // Only swipe left

        currentX = deltaX;
        
        // Deep rotation for that "throw away" feel
        const rotation = deltaX * 0.1; 
        front.style.transform = `translateX(${deltaX}px) rotate(${rotation}deg)`;
      }

      function handleEnd() {
        if (!isDragging) return;
        isDragging = false;
        front.style.transition = 'all 0.5s ease-out';

        if (currentX < -100) {
          // SWIPE SUCCESS
          front.style.transform = `translateX(-120%) rotate(-30deg)`;
          front.style.opacity = '0';
          
          // Haptic
          if (navigator.vibrate) navigator.vibrate(50);

          // Fire confetti
          fireConfetti();

          // Navigate to healthy product
          const swapId = front.dataset.swapId;
          setTimeout(() => {
            window.location.href = `product.html?id=${swapId}&celebrate=true`;
          }, 600);

        } else {
          // Reset
          front.style.transform = `translateX(0) rotate(0)`;
        }
      }

      // Events
      front.addEventListener('touchstart', e => handleStart(e.touches[0].clientX), {passive: true});
      document.addEventListener('touchmove', e => handleMove(e.touches[0].clientX), {passive: true});
      document.addEventListener('touchend', handleEnd);
      
      front.addEventListener('mousedown', e => handleStart(e.clientX));
      document.addEventListener('mousemove', e => handleMove(e.clientX));
      document.addEventListener('mouseup', handleEnd);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CONFETTI SYSTEM
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function fireConfetti() {
      const canvas = document.getElementById('confetti-canvas');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      const particles = [];
      const colors = ['#10b981', '#34d399', '#fbbf24', '#60a5fa'];

      for (let i = 0; i < 100; i++) {
        particles.push({
          x: window.innerWidth / 2,
          y: window.innerHeight / 2,
          vx: (Math.random() - 0.5) * 20,
          vy: (Math.random() - 0.5) * 20 - 5,
          size: Math.random() * 8 + 4,
          color: colors[Math.floor(Math.random() * colors.length)],
          life: 100
        });
      }

      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        let active = false;

        particles.forEach(p => {
          if (p.life > 0) {
            active = true;
            p.x += p.vx;
            p.y += p.vy;
            p.vy += 0.5; // Gravity
            p.life--;
            p.size *= 0.95; // Shrink

            ctx.fillStyle = p.color;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
            ctx.fill();
          }
        });

        if (active) requestAnimationFrame(animate);
        else ctx.clearRect(0, 0, canvas.width, canvas.height);
      }

      animate();
    }

    function showToast(title, msg) {
      // reusing existing toast logic styling if possible, or simple alert for now
      // Ideally we inject a toast div
    }
    
    function share() {
      if(navigator.share) navigator.share({url: window.location.href});
    }

    // Init
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(render, 100);
    });

  </script>
</body>
</html>
