<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#0f6b52">
  <title>Cart ‚Äî Flean</title>
  <link rel="stylesheet" href="assets/styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600;700&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    .cart-page {
      padding-bottom: 200px;
    }
    
    .cart-header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: var(--bg-elevated);
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--slate-200);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .cart-header h1 {
      font-family: var(--font-serif);
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .cart-count {
      font-size: 0.85rem;
      color: var(--slate-500);
      font-family: var(--font-sans);
      font-weight: 500;
    }
    
    .clear-cart-btn {
      color: var(--red);
      font-size: 0.85rem;
      font-weight: 600;
    }
    
    .cart-content {
      padding: 1rem;
    }
    
    /* Empty Cart */
    .cart-empty {
      text-align: center;
      padding: 4rem 2rem;
    }
    
    .cart-empty-icon {
      font-size: 5rem;
      margin-bottom: 1rem;
    }
    
    .cart-empty h2 {
      font-family: var(--font-serif);
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }
    
    .cart-empty p {
      color: var(--slate-500);
      margin-bottom: 1.5rem;
    }
    
    .cart-empty-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.875rem 2rem;
      background: var(--emerald-600);
      color: white;
      border-radius: var(--radius-full);
      font-weight: 600;
      text-decoration: none;
    }
    
    /* Cart Items */
    .cart-items {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .cart-item {
      display: flex;
      gap: 1rem;
      padding: 1rem;
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      border: 1px solid var(--slate-200);
      position: relative;
    }
    
    .cart-item-image {
      width: 80px;
      height: 80px;
      border-radius: var(--radius-lg);
      object-fit: cover;
      flex-shrink: 0;
    }
    
    .cart-item-details {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    
    .cart-item-brand {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--slate-500);
    }
    
    .cart-item-name {
      font-size: 0.95rem;
      font-weight: 600;
      line-height: 1.3;
      margin: 0.25rem 0;
    }
    
    .cart-item-meta {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.8rem;
      color: var(--slate-500);
    }
    
    .cart-item-score {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.2rem 0.5rem;
      background: var(--emerald-100);
      color: var(--emerald-700);
      border-radius: var(--radius-full);
      font-size: 0.7rem;
      font-weight: 700;
    }
    
    .cart-item-score.low {
      background: var(--red-light);
      color: #b91c1c;
    }
    
    .cart-item-actions {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      justify-content: space-between;
    }
    
    .cart-item-remove {
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--slate-100);
      border-radius: var(--radius-full);
      color: var(--slate-500);
      font-size: 1rem;
    }
    
    .cart-item-price {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--charcoal);
    }
    
    .cart-qty {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: var(--emerald-100);
      border-radius: var(--radius-full);
      padding: 0.25rem;
    }
    
    .cart-qty-btn {
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--emerald-600);
      color: white;
      border-radius: var(--radius-full);
      font-size: 1rem;
      font-weight: 600;
    }
    
    .cart-qty-value {
      font-size: 0.9rem;
      font-weight: 700;
      min-width: 20px;
      text-align: center;
    }
    
    /* Cart Health Score */
    .cart-health-card {
      background: linear-gradient(135deg, var(--emerald-50) 0%, white 100%);
      border: 2px solid var(--emerald-200);
      border-radius: var(--radius-xl);
      padding: 1.25rem;
      margin-bottom: 1.5rem;
    }
    
    .cart-health-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }
    
    .cart-health-header h3 {
      font-size: 0.9rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .cart-health-score {
      font-size: 1.25rem;
      font-weight: 800;
      color: var(--emerald-700);
    }
    
    .cart-health-bar {
      height: 8px;
      background: var(--slate-200);
      border-radius: var(--radius-full);
      overflow: hidden;
      margin-bottom: 0.75rem;
    }
    
    .cart-health-fill {
      height: 100%;
      background: var(--emerald-500);
      border-radius: var(--radius-full);
      transition: width 0.5s ease;
    }
    
    .cart-health-tip {
      font-size: 0.85rem;
      color: var(--slate-600);
    }
    
    /* Savings Card */
    .cart-savings {
      background: linear-gradient(135deg, var(--emerald-600) 0%, var(--emerald-800) 100%);
      color: white;
      border-radius: var(--radius-xl);
      padding: 1.25rem;
      margin-bottom: 1.5rem;
    }
    
    .cart-savings h3 {
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .cart-savings p {
      font-size: 0.85rem;
      opacity: 0.9;
    }
    
    /* Bill Summary */
    .bill-summary {
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      border: 1px solid var(--slate-200);
      padding: 1.25rem;
    }
    
    .bill-summary h3 {
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--slate-100);
    }
    
    .bill-row {
      display: flex;
      justify-content: space-between;
      padding: 0.5rem 0;
      font-size: 0.9rem;
    }
    
    .bill-row span:first-child {
      color: var(--slate-600);
    }
    
    .bill-row.discount span:last-child {
      color: var(--emerald-600);
    }
    
    .bill-row.total {
      padding-top: 0.75rem;
      margin-top: 0.5rem;
      border-top: 1px solid var(--slate-200);
      font-weight: 700;
      font-size: 1.1rem;
    }
    
    .bill-row.total span:last-child {
      color: var(--charcoal);
    }
    
    /* Sticky Checkout Bar */
    .checkout-bar {
      position: fixed;
      bottom: 70px;
      left: 0;
      right: 0;
      padding: 1rem 1.5rem;
      background: var(--bg-elevated);
      border-top: 1px solid var(--slate-200);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      z-index: 90;
      box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
    }
    
    .checkout-bar-total {
      display: flex;
      flex-direction: column;
    }
    
    .checkout-bar-total .label {
      font-size: 0.75rem;
      color: var(--slate-500);
    }
    
    .checkout-bar-total .amount {
      font-size: 1.5rem;
      font-weight: 800;
    }
    
    .checkout-btn {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 1rem 2rem;
      background: linear-gradient(135deg, var(--emerald-600) 0%, var(--emerald-700) 100%);
      color: white;
      border-radius: var(--radius-xl);
      font-size: 1rem;
      font-weight: 700;
      box-shadow: 0 4px 16px rgba(5, 150, 105, 0.3);
      text-decoration: none;
    }
  </style>
</head>
<body data-page="cart" class="cart-page">
  <!-- Header -->
  <header class="cart-header">
    <h1>
      <a href="index.html" style="color: var(--charcoal); text-decoration: none;">‚Üê</a>
      My Cart
      <span class="cart-count" id="cartCount">(0 items)</span>
    </h1>
    <button class="clear-cart-btn" onclick="clearCart()">Clear All</button>
  </header>

  <!-- Cart Content -->
  <main class="cart-content" id="cartContent">
    <!-- Content rendered via JS -->
  </main>

  <!-- Checkout Bar (hidden when empty) -->
  <div class="checkout-bar" id="checkoutBar" style="display: none;">
    <div class="checkout-bar-total">
      <span class="label">Total</span>
      <span class="amount" id="checkoutTotal">‚Çπ0</span>
    </div>
    <a href="checkout.html" class="checkout-btn">
      Proceed to Checkout ‚Üí
    </a>
  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <a href="index.html" class="nav-item">
      <span class="nav-icon">üè†</span>
      <span class="nav-label">Home</span>
    </a>
    <a href="flean_finds.html" class="nav-item">
      <span class="nav-icon">üíé</span>
      <span class="nav-label">Flean Finds</span>
    </a>
    <a href="profile.html" class="nav-item">
      <span class="nav-icon">üë§</span>
      <span class="nav-label">Profile</span>
    </a>
  </nav>

  <script src="assets/script.js"></script>
  <script>
    function renderCart() {
      const content = document.getElementById('cartContent');
      const countEl = document.getElementById('cartCount');
      const checkoutBar = document.getElementById('checkoutBar');
      const checkoutTotal = document.getElementById('checkoutTotal');
      
      const cart = JSON.parse(localStorage.getItem('fleanCart') || '[]');
      
      if (cart.length === 0) {
        content.innerHTML = `
          <div class="cart-empty">
            <div class="cart-empty-icon">üõí</div>
            <h2>Your cart is empty</h2>
            <p>Looks like you haven't added anything yet. Let's fix that!</p>
            <a href="index.html" class="cart-empty-btn">
              Start Shopping ‚Üí
            </a>
          </div>
        `;
        countEl.textContent = '(0 items)';
        checkoutBar.style.display = 'none';
        return;
      }
      
      // Get product details
      const cartItems = cart.map(item => {
        const product = products.find(p => p.id === item.id);
        return product ? { ...product, qty: item.qty } : null;
      }).filter(Boolean);
      
      const itemCount = cartItems.reduce((sum, item) => sum + item.qty, 0);
      const subtotal = cartItems.reduce((sum, item) => sum + (item.price * item.qty), 0);
      const deliveryFee = subtotal >= 200 ? 0 : 25;
      const platformFee = 2;
      const total = subtotal + deliveryFee + platformFee;
      
      // Calculate cart health score (weighted average)
      const avgScore = Math.round(
        cartItems.reduce((sum, item) => sum + (item.healthScore * item.qty), 0) / itemCount
      );
      
      countEl.textContent = `(${itemCount} items)`;
      checkoutBar.style.display = 'flex';
      checkoutTotal.textContent = `‚Çπ${total}`;
      
      content.innerHTML = `
        <!-- Cart Items -->
        <div class="cart-items">
          ${cartItems.map(item => `
            <div class="cart-item" data-id="${item.id}">
              <img src="${item.image}" alt="${item.name}" class="cart-item-image" onerror="this.src='https://via.placeholder.com/80'">
              <div class="cart-item-details">
                <div>
                  <span class="cart-item-brand">${item.brand}</span>
                  <h3 class="cart-item-name">${item.name}</h3>
                  <div class="cart-item-meta">
                    <span>${item.unit}</span>
                    <span class="cart-item-score ${item.healthScore < 60 ? 'low' : ''}">${item.healthScore}/100</span>
                  </div>
                </div>
                <div class="cart-qty">
                  <button class="cart-qty-btn" onclick="updateCartItem('${item.id}', -1)">‚àí</button>
                  <span class="cart-qty-value">${item.qty}</span>
                  <button class="cart-qty-btn" onclick="updateCartItem('${item.id}', 1)">+</button>
                </div>
              </div>
              <div class="cart-item-actions">
                <button class="cart-item-remove" onclick="removeFromCart('${item.id}')">√ó</button>
                <span class="cart-item-price">‚Çπ${item.price * item.qty}</span>
              </div>
            </div>
          `).join('')}
        </div>
        
        <!-- Cart Health Score -->
        <div class="cart-health-card">
          <div class="cart-health-header">
            <h3>üå± Cart Health Score</h3>
            <span class="cart-health-score">${avgScore}/100</span>
          </div>
          <div class="cart-health-bar">
            <div class="cart-health-fill" style="width: ${avgScore}%; background: ${avgScore >= 70 ? 'var(--emerald-500)' : avgScore >= 50 ? 'var(--amber)' : 'var(--red)'}"></div>
          </div>
          <p class="cart-health-tip">
            ${avgScore >= 80 ? '‚ú® Excellent choices! Your cart is full of healthy picks.' :
              avgScore >= 60 ? 'üëç Good job! Consider swapping a few items to boost your score.' :
              'üí° Tip: Swap some items for healthier alternatives to improve your score.'}
          </p>
        </div>
        
        <!-- Savings -->
        ${subtotal >= 200 ? `
          <div class="cart-savings">
            <h3>üéâ You're saving ‚Çπ25!</h3>
            <p>Free delivery on orders above ‚Çπ200</p>
          </div>
        ` : `
          <div class="cart-savings" style="background: linear-gradient(135deg, var(--slate-600) 0%, var(--slate-800) 100%);">
            <h3>üì¶ Add ‚Çπ${200 - subtotal} more for free delivery</h3>
            <p>Currently: ‚Çπ25 delivery fee</p>
          </div>
        `}
        
        <!-- Bill Summary -->
        <div class="bill-summary">
          <h3>Bill Details</h3>
          <div class="bill-row">
            <span>Item Total</span>
            <span>‚Çπ${subtotal}</span>
          </div>
          <div class="bill-row ${deliveryFee === 0 ? 'discount' : ''}">
            <span>Delivery Fee</span>
            <span>${deliveryFee === 0 ? 'FREE' : `‚Çπ${deliveryFee}`}</span>
          </div>
          <div class="bill-row">
            <span>Platform Fee</span>
            <span>‚Çπ${platformFee}</span>
          </div>
          <div class="bill-row total">
            <span>Grand Total</span>
            <span>‚Çπ${total}</span>
          </div>
        </div>
      `;
    }
    
    function updateCartItem(productId, delta) {
      let cart = JSON.parse(localStorage.getItem('fleanCart') || '[]');
      const item = cart.find(i => i.id === productId);
      
      if (item) {
        item.qty += delta;
        if (item.qty <= 0) {
          cart = cart.filter(i => i.id !== productId);
        }
      }
      
      localStorage.setItem('fleanCart', JSON.stringify(cart));
      renderCart();
    }
    
    function removeFromCart(productId) {
      let cart = JSON.parse(localStorage.getItem('fleanCart') || '[]');
      cart = cart.filter(i => i.id !== productId);
      localStorage.setItem('fleanCart', JSON.stringify(cart));
      renderCart();
    }
    
    function clearCart() {
      if (confirm('Remove all items from cart?')) {
        localStorage.setItem('fleanCart', '[]');
        renderCart();
      }
    }
    
    // Init
    document.addEventListener('DOMContentLoaded', renderCart);
  </script>
</body>
</html>

